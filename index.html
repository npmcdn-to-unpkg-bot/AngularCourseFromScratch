<!DOCTYPE html>
<html ng-app="phonebook">
  <head>

    <title>Phonebook</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="libs/bootstrap-3.3.6/css/bootstrap.min.css">
    
    
    <style>
      .jumbotron, .footer{
        width: 600px;
        text-align: center;
        margin-left: auto;
        margin-right: auto;
        margin-top: 20px;
        padding-left: 10px;
        padding-right:10px;
      }
      
      .selected {
        background: yellow;
      }
      
    </style>
    
    <script src="libs/angular-1.5.5/angular.min.js"></script>
    <script src="libs/angular-1.5.5/i18n/angular-locale_pt-br.js"></script>
    
    <script>
      var app = angular.module("phonebook", []);
      app.controller("phonebookCtrl", function($scope, $filter, uppercaseFilter){
        $scope.app = "Phonebook!";
        
        //$filter is a function that receive a input.
        //uppercaseFilter is uppercase sufixed with $filter.
        $scope.contacts = [
          {name : $filter("uppercase")("Pedro"), phone : "99998888", date : new Date(), operator : {name : "Oi", code : 14, category : "Mobile"}},
          {name : $filter("uppercase")("Ana"), phone : "99998555", date : new Date(), operator : {name : "Tim", code : 41, category : "Mobile"}},
          {name : uppercaseFilter("Maria"), phone : "91998999", date : new Date(), operator : {name : "Vivo", code : 15, category : "Mobile"}},
          {name : uppercaseFilter("Marcia"), phone : "99998777", date : new Date(), operator : {name : "Oi", code : 14, category : "Mobile"}}
        ];
        
        $scope.operators = [
          {name : "Oi", code : 14, category : "Mobile", price : 2},
          {name : "Tim", code : 41, category : "Mobile", price : 1},
          {name : "Vivo", code : 15, category : "Mobile", price : 2},
          {name : "GVT", code : 25, category : "Landline", price : 3},
          {name : "Embratel", code : 21, category : "Landline", price : 1}
        ];
        
        $scope.addContact = function(contact){
          $scope.contacts.push(angular.copy(contact));
          delete $scope.contact;
        };
        
        $scope.removeContact = function(contacts){
          $scope.contacts = contacts.filter(function( c ) {
            if (!c.selected) {
              return c;
            }            
          });
        };
        
        $scope.isContactSelected = function(contacts){
          return contacts.some(function( c ) {
            return c.selected;
          });
        };
        
        $scope.orderBy = function(field){
          $scope.orderByField = field;
          $scope.directionoOfOrder = !$scope.directionoOfOrder;
        };

      });
      
    </script>
    
  </head>
  <body>

    <div ng-controller="phonebookCtrl">
      
      <div class="jumbotron">
        <h3> {{ app }} </h3>
        
        <input type="text" class="form-control" ng-model="search" placeholder="Type for seach" />
        
        <table ng-show="contacts.length > 0" class="table">
          <thead>
            <tr>
              <th></th>
              <th><a href="" ng-click="orderBy('nome')">Name</a></th>
              <th><a href="" ng-click="orderBy('phone')">Phone</a></th>
              <th><a href="" ng-click="orderBy('operator')">Operator</a></th>
              <th><a href="" ng-click="orderBy('date')">Date</a></th>
            </tr>
          </thead>
          
          <tbody>
            
            <tr ng-class="{ selected : c.selected }" ng-repeat="c in contacts | filter:search | orderBy:orderByField:directionoOfOrder">
              <td><input type="checkbox" ng-model="c.selected" /></td>
              <td>{{c.name }}</td>
              <td>{{c.phone}}</td>
              <td>{{c.operator.name | lowercase}}</td>
              <td>{{c.date | date:'dd/MM/yyyy HH:mm' }}</td>
            </tr>
          </tbody>
            
        </table>
        
        <hr>
        
        <input class="form-control" type="text" placeholder="Name" ng-model="contact.name">
        <input class="form-control" type="text" placeholder="Phone" ng-model="contact.phone">
        
        <select class="form-control" ng-model="contact.operator" ng-options="operator.name + ' (' + (operator.price | currency) + ')' group by operator.category for operator in operators | orderBy:'name'">
          <option value="">Select one operator</option>
        </select>
        
        <button class="btn btn-primary btn-block" 
          ng-click="addContact(contact)"
          ng-disabled="!contact.name || !contact.phone"
        >Add contact</button>
        
        <button class="btn btn-danger btn-block" 
          ng-click="removeContact(contacts)"
          ng-if="isContactSelected(contacts)"
        >Remove contact</button>
        
      </div>

    </div>

    <div class="footer" ng-include="'footer.html'"></div>
  </body>
  
</html>
